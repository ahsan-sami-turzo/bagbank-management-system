{% extends "base.html" %}
{% from "bootstrap5/form.html" import render_form %}

{% block content %}
<div class="container mt-4">
    
    <h2><i class="fas fa-archive"></i> {{ action_text }} Product Details</h2>
    <hr>
    
    {% include '_flash_messages.html' %}

    <div class="row">
        <div class="col-md-6">
            <h4 class="mb-3">Core Information</h4>
            <form method="POST">
                {{ form.csrf_token }}
                
                {# Use render_form to display all fields #}
                {{ render_form(form) }}
            </form>
        </div>
    </div>
    
    {% if product.id %}
    <hr class="mt-5">
    
    <div class="row mt-5">
        <div class="col-12">
            <h3>Product Variants (SKUs)</h3>
            <p>
                <a href="{{ url_for('product.edit_variant', product_id=product.id) }}" class="btn btn-success">
                    <i class="fas fa-plus-circle"></i> Add New Variant
                </a>
            </p>

            {% if product.variants.all() %}
            <table class="table table-striped table-hover mt-3">
                <thead>
                    <tr>
                        <th>Color</th>
                        <th>SKU</th>
                        <th>Price</th>
                        <th>Stock</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for variant in product.variants.all() %}
                    <tr>
                        <td>
                            {# Display color swatch and name #}
                            <div style="width: 20px; height: 20px; background-color: {{ variant.color.hex_code }}; border: 1px solid #ccc; border-radius: 4px; display: inline-block; vertical-align: middle;"></div>
                            {{ variant.color.name }}
                        </td>
                        <td>{{ variant.sku }}</td>
                        <td>${{ "{:,.2f}".format(variant.price) }}</td>
                        <td><span class="badge bg-{{ 'success' if variant.stock > 0 else 'danger' }}">{{ variant.stock }}</span></td>
                        <td>
                            <a href="{{ url_for('product.edit_variant', product_id=product.id, variant_id=variant.id) }}" class="btn btn-sm btn-warning me-2">
                                <i class="fas fa-edit"></i> Edit Variant
                            </a>
                            {# Delete link placeholder #}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="alert alert-warning" role="alert">
                No variants found for this product. Add one above.
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
    
    <p class="mt-3">
        <a href="{{ url_for('product.list_products') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Product List
        </a>
    </p>
</div>
{% endblock %}